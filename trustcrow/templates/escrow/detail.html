{% extends "dashboard.html" %}
{% load static humanize %}

{% block title %}
{{ block.super }} {{object.contract_uudi}}
{% endblock title %}

{% block records %}{% endblock records %}

{% block content %}
<section class="hidden mb-6 w-full ml-auto p-4 md:px-10 md:py-0 flex items-center md:justify-end space-x-4">
  {% if object.contract_type == "SERVICE" and object.get_service %}<button class="btn-black btn-rounded text-sm">Add Service</button>{% elif object.contract_type == "PRODUCT" %}<button class="btn-black btn-rounded text-sm">Add Products</button>{% endif %}
</section>

<section x-data="ContractDetailForm" id="detail" class="antialiased responsive w-full p-4 md:px-10 md:py-8">
    <div class="relative w-full space-y-4 bg-white rounded-xl shadow-md px-4 pt-4 pb-44">
        <div class="flex items-center justify-between w-full px-4 py-4">
          <div class="ml-auto">
            <div class="relative mr-4 inline-block">
              <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip = true" @mouseleave="showTooltip = false" @click="printInvoice()">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-printer" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="0" y="0" width="24" height="24" stroke="none"></rect>
                  <path d="M17 17h2a2 2 0 0 0 2 -2v-4a2 2 0 0 0 -2 -2h-14a2 2 0 0 0 -2 2v4a2 2 0 0 0 2 2h2" />
                  <path d="M17 9v-4a2 2 0 0 0 -2 -2h-6a2 2 0 0 0 -2 2v4" />
                  <rect x="7" y="13" width="10" height="8" rx="2" />
                </svg>
              </div>
              <div x-show.transition="showTooltip" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
                Print this invoice!
              </div>
            </div>

            <div class="relative inline-block">
              <div class="text-gray-500 cursor-pointer w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-300 inline-flex items-center justify-center" @mouseenter="showTooltip2 = true" @mouseleave="showTooltip2 = false" @click="window.location.reload()">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-refresh" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                  <rect x="0" y="0" width="24" height="24" stroke="none"></rect>
                  <path d="M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -5v5h5" />
                  <path d="M4 13a8.1 8.1 0 0 0 15.5 2m.5 5v-5h-5" />
                </svg>
              </div>
              <div x-show.transition="showTooltip2" class="z-40 shadow-lg text-center w-32 block absolute right-0 top-0 p-2 mt-12 rounded-lg bg-gray-800 text-white text-xs">
                Reload Page
              </div>
            </div>
          </div>
        </div>
        <div class="md:flex items-start md:justify-between space-y-4 md:space-y-0 w-full px-4 py-4">
            <div class="flex items-center space-x-3">
                <img src="{% if object.vendor_email == request.user.email and request.user.profile.company_logo %}{{user.profile.company_logo.url}}{% else %}https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460__480.png{% endif %}" class="h-8 md:h-12 aspect-1 flex-none rounded-full" alt="Vendor Logo">
                <h2 class="text-sm md:text-2xl block">
                    <strong class="block font-bold tracking-wider uppercase">ESCROW CONTRACT</strong>
                    <span class="block text-s md:text-sm text-gray-400 lowecase font-normal">{{object.vendor_email}}</span>
                </h2>
            </div>
            <div class="flex-none text-left md:text-right w-2/4 md:w-1/5">
                <span class="text-gray-400 text-sm md:text-base flex items-start space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 md:hidden">
                        <path fill-rule="evenodd" d="M11.54 22.351l.07.04.028.016a.76.76 0 00.723 0l.028-.015.071-.041a16.975 16.975 0 001.144-.742 19.58 19.58 0 002.683-2.282c1.944-1.99 3.963-4.98 3.963-8.827a8.25 8.25 0 00-16.5 0c0 3.846 2.02 6.837 3.963 8.827a19.58 19.58 0 002.682 2.282 16.975 16.975 0 001.145.742zM12 13.5a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
                    </svg>
                    <span class="block">{{object.vendor_address}}</span>
                </span>
            </div>
        </div>

        <div class="relative overflow-hidden w-full p-4 rounded-xl bg-warning text-gray-700">
            <div class="hidden md:block w-44 aspect-1 border-8 border-white/10 rounded-full absolute -top-10 -left-14"></div>
            <div class="hidden md:block w-72 aspect-1 border-8 border-white/10 rounded-full absolute -bottom-10 left-[24%]"></div>
            <div class="hidden md:block w-64 aspect-1 border-8 border-white/10 rounded-full absolute top-32 left-[45%]"></div>
            <div class="hidden md:block w-44 aspect-1 border-8 border-white/10 rounded-full absolute -top-10 right-[24%]"></div>
            <div class="hidden md:block w-44 aspect-1 border-8 border-white/10 rounded-full absolute -bottom-10 -right-14"></div>

            <div class="divide-y-[0.75px] divide-gray-700 md:grid md:grid-cols-2  md:divide-y-0 md:divide-x-[0.75px] py-6 w-full my-auto md:flex items-start md:justify-between space-y-4 md:space-y-0">
                <div class="text-xs font-semibold">
                    <strong class="text-base font-bold pb-4">Contract Details</strong>
                    <p><span class="font-bold">#ID:</span>       <span class="pl-2 font-normal">{{object.contract_uuid}}</span></p>
                    <p><span class="font-bold">Issued On:</span>       <span class="pl-2 font-normal">{{object.created|date:"M d, Y"}}</span></p>
                    <p><span class="font-bold">Started From:</span>       <span class="pl-2 font-normal">{% if object.contract_started %}{{object.contract_started|date:"M d, Y"}}{% else %}Not Approved{% endif %}</span></p>
                    <p><span class="font-bold">Completed On:</span>       <span class="pl-2 font-normal">{{object.contract_ended|date:"M d, Y"}}</span></p>
                </div>

                <div class="text-xs font-semibold md:text-right pt-4 md:pt-0">
                    <strong class="text-base font-bold pb-4">Bill/Ship To</strong>
                    <div class="flex items-center space-x-2 text-right w-full md:justify-end"><span class="font-bold md:order-2 block md:pl-2 order-1">Name</span>       <span class="pl-2 pr-0 md:pl-0 order-2 font-normal md:order-1 md:pr-2 block">{{object.buyer}}</span></div>
                    <div class="flex items-center space-x-2 text-right w-full md:justify-end"><span class="font-bold md:order-2 block md:pl-2 order-1">Email</span>       <span class="pl-2 pr-0 md:pl-0 order-2 font-normal md:order-1 md:pr-2 block">{{object.buyer_email}}</span></div>
                    <div class="flex items-center space-x-2 text-right w-full md:justify-end"><span class="font-bold md:order-2 block md:pl-2 order-1">Phone</span>       <span class="pl-2 pr-0 md:pl-0 order-2 font-normal md:order-1 md:pr-2 block">{{object.buyer_phone}}</span></div>
                </div>
            </div>
        </div>

        <!-- <div class="md:grid md:grid-cols-2 md:gap-5 space-y-5 md:space-y-0">
            <div class="w-full p-4">
                <div class="flex-1 px-1 py-2">
                    <p class="text-gray-800 uppercase tracking-wide text-sm font-bold">Contract Agreement</p>
                </div>
                <div class="min-h-1/4 text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="" cols="30" rows="50">
                    {{object.terms_agreement|safe|capfirst}}
                </div>
            </div>
            <div class="w-full p-4">
                <div class="flex-1 px-1 py-2">
                    <p class="text-gray-800 uppercase tracking-wide text-sm font-bold md:text-right">Terms for Termination</p>
                </div>
                <div class="min-h-1/4 text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="" cols="30" rows="50">
                    {{object.terms_for_termination|safe|capfirst}}
                </div>
            </div>
        </div> -->

        <div class="h-1 w-[calc(100%_-_32px)] mx-auto bg-gray-200"></div>

        {% if object.contract_type == object.SERVICE %}
        <div class="px-4">
            <div class="flex-1 px-1 py-2 mb-8">
                <p class="text-gray-800 uppercase tracking-wide text-sm font-bold flex items-center justify-between">
                    <span class="block">Service Milestones</span>

                    {% if object.creator == "Contractor" and object.buyer_email == request.user.email or object.creator == "Vendor" and object.vendor_email == request.user.email %}
                    <span hx-get="{% url 'escrow:add_milestones_form' object.slug %}" hx-swap="afterbegin" hx-target="#mform" class="flex group items-center space-x-2 cursor-pointer ">
                        <strong class="block text-sm">New</strong>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 group-hover:h-8 group-hover:w-8 duration-300">
                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd" />
                        </svg>
                    </span>
                    {% endif %}
                  </p>
            </div>

            <div id="miles" class="hidden">
                {% if not object.all_milestones %}
                <div class="w-full rounded-xl text-center text-gray-500 text-sm p-4 mx-auto max-w-md">
                    There is no milestone for this service. Create one now else it shall be assumed this service has no milestone.
                </div>
                {% endif %}
            </div>

            <div id="mform" class="space-y-5">
                {% for obj in object.all_milestones %}
                <div hx-target="this" hx-swap="outerHTML" class="bg-gray-100 relative overflow-hidden space-y-4 hover:shadow-xl py-4 duration-500 bg-white rounded-xl">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="relative">
                            <div class="flex items-center space-x-3 block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-100 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008h-.008V15zm0 2.25h.008v.008h-.008v-.008zm2.25-4.5h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" />
                                </svg>
                                <span class="block">{{obj.deadline|date:"M d, Y"}}</span>
                            </div>
                            <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Milestone Deadline</label>
                        </div>
                        <div class="relative">
                            <div class="flex items-center space-x-3 block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-100 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                                </svg>
                                <span class="block">₦ {{obj.price|floatformat:2|intcomma}}</span>
                            </div>
                            <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Milestone Cost</label>
                        </div>
                    </div>
                    <div class="relative px-4">
                        <div class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-200 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">{{obj.detail|safe}}</div>
                        <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 flex items-center space-x-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13" />
                            </svg>
                            <span class="block">Milestone Requirements</span>
                        </label>
                    </div>

                    {% if not obj.accepted and object.buyer_email == request.user.email %}
                    <button hx-get="{% url 'escrow:milestone_approve' obj.id %}" class="uppercase flex items-center space-x-2 btn-black btn-rounded text-s absolute -top-2 right-4">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                        <span class="block">Mark</span>
                    </button>
                    {% elif obj.accepted %}
                    <button class="text-s uppercase bg-success text-white flex items-center space-x-2 absolute right-4 top-0 px-4 py-2 rounded-xl">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                        <span class="block">Done</span>
                    </button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="px-4">
            <div class="flex-1 px-1 py-2 mb-8">
                <p class="text-gray-800 uppercase tracking-wide text-sm font-bold flex items-center justify-between">
                    <span class="block">Product Orders</span>

                    {% if object.creator == "Contractor" and object.buyer_email == request.user.email or object.creator == "Vendor" and object.vendor_email == request.user.email %}
                    <button hx-get="{% url 'escrow:add_product_form' object.slug %}" hx-swap="afterbegin" hx-target="#mform" class="flex group items-center space-x-2 cursor-pointer ">
                        <strong class="block text-sm">New</strong>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 group-hover:h-8 group-hover:w-8 duration-300">
                            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    {% elif not obj.accepted and object.vendor_email == request.user.email %}
                    <button class="uppercase flex items-center space-x-2 px-3 py-2 bg-success text-white btn-rounded text-s absolute hover:shadow-md duration-300 -top-2 right-2">
                        <span class="block">Waiting</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                          <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    {% elif obj.accepted and object.vendor_email == request.user.email or obj.accepted and object.buyer_email == request.user.email %}
                    <button class="uppercase flex items-center space-x-2 px-3 py-2 bg-success text-white btn-rounded text-s absolute hover:shadow-md duration-300 -top-2 right-2">
                        <span class="block">Done</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </button>
                    {% endif %}
                  </p>
            </div>

            <div id="miles" class="hidden">
                {% if not object.get_products %}
                <div class="w-full rounded-xl text-center text-gray-500 text-sm p-4 mx-auto max-w-md">
                    There is no milestone for this service. Create one now else it shall be assumed this service has no milestone.
                </div>
                {% endif %}
            </div>

            <div id="mform" class="grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-8">
                {% for obj in object.get_products %}
                <div hx-target="this" hx-swap="outerHTML" class="bg-gray-100 relative space-y-4 hover:shadow-xl py-4 duration-500 bg-white rounded-xl">
                    <div class="flex space-x-4 items-start">
                        <div class="ml-4 mt-4 md:w-14 w-6 md:h-14 h-6 rounded-xl border overflow-hidden bg-gray-100 flex-none">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="md:w-14 w-6 md:h-14 h-6 flex-none text-primary">
                                <path d="M12 9a3.75 3.75 0 100 7.5A3.75 3.75 0 0012 9z" />
                                <path fill-rule="evenodd" d="M9.344 3.071a49.52 49.52 0 015.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 01-3 3h-15a3 3 0 01-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 001.11-.71l.822-1.315a2.942 2.942 0 012.332-1.39zM6.75 12.75a5.25 5.25 0 1110.5 0 5.25 5.25 0 01-10.5 0zm12-1.5a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="space-y-1 w-full">
                            <div class="relative">
                                <div class="flex items-center space-x-3 block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-90 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13" />
                                    </svg>
                                    <span class="block">{{obj.product.title|title}}</span>
                                </div>
                                <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Product Name</label>
                            </div>
                            <div class="md:flex md:space-y-0 md:items-center space-y-4 justify-between">
                                <div class="relative  min-w-fit">
                                    <div class="flex items-center space-x-3 block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                                        </svg>
                                        <span class="block">₦ {{obj.price|floatformat:2|intcomma}}</span>
                                    </div>
                                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">Product Cost</label>
                                </div>
                                <div class="relative min-w-fit">
                                    <div class="flex items-center space-x-3 block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                                        </svg>
                                        <span class="block">{{obj.quantity}}</span>
                                    </div>
                                    <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1">QTY</label>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="relative px-4">
                        <div class="block px-2.5 pb-2.5 pt-4 w-full text-sm text-gray-900 bg-gray-200 rounded-lg border-1 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-warning/60 focus:outline-none focus:ring-0 focus:border-warning peer">{{obj.product.detail|safe}}</div>
                        <label class="absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-gray-100 dark:bg-gray-900 px-2 peer-focus:px-2 peer-focus:text-warning peer-focus:dark:text-warning/60 peer-placeholder-shown:scale-100 peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 flex items-center space-x-3">
                            <span class="block">Details</span>
                        </label>
                    </div>
                    {% if not obj.accepted and object.buyer_email == request.user.email %}
                    <button hx-get="{% url 'escrow:approve_product' obj.id %}" class="uppercase flex items-center space-x-2 px-3 py-2 bg-warning btn-rounded text-s absolute hover:shadow-md duration-300 -top-2 right-2">
                        <span class="block">Mark</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </button>
                    {% elif not obj.accepted and object.vendor_email == request.user.email %}
                    <button class="uppercase flex items-center space-x-2 px-3 py-2 bg-success text-white btn-rounded text-s absolute hover:shadow-md duration-300 -top-2 right-2">
                        <span class="block">Waiting</span>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6">
                          <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    {% elif obj.accepted and object.vendor_email == request.user.email or obj.accepted and object.buyer_email == request.user.email %}
                    <button class="uppercase flex items-center space-x-2 px-3 py-2 bg-success text-white btn-rounded text-s absolute hover:shadow-md duration-300 -top-2 right-2">
                        <span class="block">Done</span>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </button>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>


    <div x-data="ContractForm" class="rounded-xl bg-gray-700 text-white mt-8 w-full md:flex md:items-center md:space-x-4 px-4 md:px-10 py-7 md:justify-between md:space-y-0 space-y-5 w-full">
        <div class="space-y-1">
            <h4 class="text-sm uppercase">Total Amount</h4>
            <div class="text-xl font-bold text-2xl space-x-3 flex items-center"><span class="block">₦</span> <span class="block">{{object.contract_amount|floatformat:2}}</span></div>
        </div>

        {% if not object.vendor_approve and object.vendor_email == request.user.email %}
        <button hx-get="{% url 'escrow:vendor_approve' object.slug %}" class="font-bold text-white btn-success px-6 py-4 hover:scale-105 duration-500 btn-rounded text-sm block">Approve Contract</button>
        {% endif %}

        {% if not object.buyer_approve and object.buyer_email == request.user.email %}
        <button @click="retryPayment('{{object.contract_transaction.ref_link}}')" class="font-bold text-white btn-success px-6 py-4 hover:scale-105 duration-500 btn-rounded text-sm block">Approve & Pay for Contract</button>
        {% endif %}

        {% if object.vendor_approve and object.buyer_approve %}
        <button class="text-center font-bold uppercase bg-success px-5 py-3 rounded-xl block">APPROVED</button>
        {% else %}
        <button class="text-center text-white font-bold uppercase bg-danger px-5 py-3 rounded-xl block">UNAPPROVED</button>
        {% endif %}
    </div>



    <!-- Print Template -->
		<div id="js-print-template" x-ref="printTemplate" class="hidden">
        <div class="border-t-4 border-gray-700 h-2"></div>
        <div class="w-full space-y-4 bg-gray-100">
            <div class="flex items-center justify-between w-full px-4 py-4">
              <h2 class="text-sm md:text-2xl font-bold tracking-wider uppercase block">ESCROW CONTRACT</h2>
            </div>
            <div class="md:justify-between md:flex md:items-center px-4 py-4">
                <div class="w-full md:w-3/4">
                    <div class="mb-2 md:mb-1 md:flex items-center">
                      <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Contract No.</label>
                      <span class="mr-4 inline-block hidden md:block">:</span>
                      <div class="flex-1">
                      <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #INV-100001" value="{{object.contract_uudi}}">
                      </div>
                    </div>

                    <div class="mb-2 md:mb-1 md:flex items-center">
                        <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Contract Type.</label>
                        <span class="mr-4 inline-block hidden md:block">:</span>
                        <div class="flex-1">
                        <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #INV-100001" value="{{object.contract_type}}">
                        </div>
                    </div>

                    <div class="mb-2 md:mb-1 md:flex items-center">
                        <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Contract Amount.</label>
                        <span class="mr-4 inline-block hidden md:block">:</span>
                        <div class="flex-1">
                        <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #INV-100001" value="NGN {{object.total_cost|floatformat:2}}">
                        </div>
                    </div>

                    <div class="mb-2 md:mb-1 md:flex items-center">
                        <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Contract Paid.</label>
                        <span class="mr-4 inline-block hidden md:block">:</span>
                        <div class="flex-1">
                        <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="eg. #INV-100001" value="{% if object.contract_paid %}PAID{% else %}UNPAID{% endif %}">
                        </div>
                    </div>


                    <div class="mb-2 md:mb-1 md:flex items-center">
                      <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Start Date</label>
                      <span class="mr-4 inline-block hidden md:block">:</span>
                      <div class="flex-1">
                      <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500 js-datepicker" type="text" id="datepicker1" placeholder="eg. 17 Feb, 2020" autocomplete="off" readonly value="{% if object.contract_started %}{{object.contract_started|date:'d M, Y'}}{% else %}NOT YET STARTED{% endif %}">
                      </div>
                    </div>

                    <div class="mb-2 md:mb-1 md:flex items-center">
                      <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Complete Date</label>
                      <span class="mr-4 inline-block hidden md:block">:</span>
                      <div class="flex-1">
                      <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-96 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500 js-datepicker-2" id="datepicker2" type="text" placeholder="eg. 17 Mar, 2020" autocomplete="off" readonly value="{% if object.contract_ended %}{{object.contract_ended|date:'d M, Y'}}{% else %}NOT YET ENDED{% endif %}">
                      </div>
                    </div>
                  </div>

            </div>
            <div class="flex flex-wrap justify-between p-4">
                <div class="w-full md:w-1/3 mb-2 md:mb-0">
                    <label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">Bill/Ship To:</label>
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Billing company name" value="{{object.buyer|title}}">
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Billing company address" value="{{object.buyer_phone}}">
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" value="{{object.buyer_email}}">
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" value="{% if object.buyer_approve %}APPROVED{% else %}UNAPPROVED{% endif %}">
                </div>
                <div class="w-full md:w-1/3">
                    <label class="text-gray-800 block mb-1 font-bold text-sm uppercase tracking-wide">From:</label>
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Your company name" value="{{object.vendor|title}}">

                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Your company address" value="{{object.vendor_phone}}">

                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" value="{{object.vendor_email}}">
                    <input class="text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Additional info" value="{% if object.vendor_approve %}APPROVED{% else %}UNAPPROVED{% endif %}">
                </div>
            </div>


            {% if object.service or object.product %}
            <div class="bg-gray-400 w-full px-4 py-3 mt-6 border-y-[0.75px] border-gray-300 flex items-center justify-between">
                <div class="flex-1 px-1 py-1">
                    <p class="text-gray-800 uppercase tracking-wide text-base font-bold">{% if object.contract_type == "SERVICE" %}Service{% else %}Product{% endif %} Information</p>
                </div>
                <div class="flex items-center space-x-3">
                    {% if object.contract_type == "SERVICE" and not object.service %}
                    <button class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" x-on:click="openServiceModal = !openServiceModal">
                        Add Service
                    </button>
                    {% elif object.contract_type == "PRODUCT" %}
                    <button class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" x-on:click="openModal = !openModal">
                        Add Products
                    </button>
                    {% endif %}

                    {% if object.service %}
                    <button class="bg-white hover:bg-gray-100 text-gray-700 font-semibold py-2 px-4 text-sm border border-gray-300 rounded shadow-sm" x-on:click="openServiceModal = !openServiceModal">
                        Add Milestone
                    </button>
                    {% endif %}
                </div>
            </div>
                {% if object.service %}
                <div class="w-full px-4 pt-4 pb-1">
                    <div class="mb-4">
                        <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Service Name.</label>
                        <div class="flex-1">
                            <input class="bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full md:w-2/4 text-sm font-semibold py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="inline-full-name" type="text" placeholder="Architecture Design, Software Programming,.." value="{{object.service.service.service_name}}">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Service Description.</label>
                        <div class="flex-1">
                            <div class="min-h-1/4 text-sm mb-1 bg-gray-200 appearance-none border-2 border-gray-200 rounded w-full py-2 px-4 text-gray-700 leading-tight focus:outline-none focus:bg-white focus:border-blue-500" id="" cols="30" rows="50">
                                {{object.service.service.service_description|safe|capfirst}}
                            </div>
                        </div>
                    </div>
                </div>
                    {% if object.service.get_milestones %}
                    <div class="w-full space-y-6 p-4 divide-y-2 divide-gray-300">
                        <div class="bg-gray-400 py-2 px-3">
                            <label class="w-44 text-gray-800 block font-bold text-sm uppercase tracking-wide">Service Milestones.</label>
                        </div>

                        {% for obj in object.service.get_milestones %}
                        <div class="flex items-center space-x-5 pt-4">
                            <!-- <div class="text-xl font-bold"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-2 h-2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" />
                              </svg>
                              </div> -->
                            <div class="w-full space-y-5">
                                <div class="flex items-start justify-between">
                                    <div class="space-y-4">
                                        <div class="space-y-1.5">
                                            <div class="font-bold text-sm text-gray-800 uppercase">Due Date</div>
                                            <div class="rounded-md bg-gray-200 p-2 font-semibold text-sm w-32">{{obj.milestone_deadline|date:"d M, Y"}}</div>
                                        </div>
                                        <div class="space-y-1.5">
                                            <div class="font-bold text-sm text-gray-800 uppercase">Milestone Cost</div>
                                            <div class="rounded-md bg-gray-200 p-2 font-semibold text-sm w-32">NGN {{obj.milestone_fee}}</div>
                                        </div>
                                    </div>
                                    <div class="space-y-1.5">
                                        <div class="font-bold text-sm text-gray-800 uppercase">Completed?</div>
                                        <div class="rounded-md font-semibold text-sm w-32">{% if obj.milestone_complete %}Completed{% else %}<button class="px-4 py-2 text-sm bg-green-800 text-white">Mark Done</button>{% endif %}</div>
                                    </div>
                                </div>
                                <div class="space-y-1.5">
                                    <div class="font-bold text-sm text-gray-800 uppercase">Milestone Requirement</div>
                                    <div class="rounded-md bg-gray-200 p-2 font-semibold text-sm">{{obj.milestone_detail|safe|capfirst}}</div>
                                </div>
                            </div>
                        </div>
                        {% if not forloop.last %}
                        <div class="w-full h-1 bg-gray-300"></div>
                        {% endif %}
                        {% endfor %}
                    </div>
                    {% endif %}
                {% else %}
                <div class="w-full px-4 md:px-10 pt-4 pb-1 grid grid-cols-2 md:grid-cols-6">
                    {% for obj in object.product.product.all %}
                    <div class="h-44 rounded-md space-y-2">
                        <img src="{{obj.get_images}}" alt="" class="w-44 aspect-1 rounded-md object-cover">
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
		<!-- /Print Template -->


</section>
{% endblock content %}
